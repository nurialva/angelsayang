<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Angel Planner</title>
    <link rel="manifest" href="manifest.json">
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <style>
        :root { 
            --pink-deep: #ff5c8a;
            --pink-main: #ff85a2; 
            --pink-soft: #ffcad4;
            --pink-bg: #fff9fa;
            --text-dark: #2d1b1e;
            --header-h: 70px;
            --nav-h: 80px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body, html { 
            height: 100%; margin: 0; padding: 0; 
            overflow: hidden; background: var(--pink-bg);
            font-family: 'Plus Jakarta Sans', sans-serif;
            color: var(--text-dark);
        }

        /* --- LOGIN STYLING (THE NEW LOOK) --- */
        #view-login { 
            position: fixed; inset: 0; 
            background: linear-gradient(135deg, #fff0f3 0%, #ffcad4 100%);
            display: flex; align-items: center; justify-content: center; z-index: 2000;
            overflow: hidden;
        }

        /* Dekorasi Hati Melayang di Background */
        .bg-heart {
            position: absolute; color: rgba(255, 133, 162, 0.2);
            animation: float 6s infinite ease-in-out; z-index: 0;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0); }
            50% { transform: translateY(-20px) rotate(20deg); }
        }

        .login-card {
            width: 88%; position: relative; z-index: 10;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            padding: 40px 30px; border-radius: 40px;
            text-align: center;
            box-shadow: 0 25px 50px rgba(255, 92, 138, 0.15);
        }

        .login-card .logo-area {
            width: 80px; height: 80px; background: white;
            border-radius: 25px; margin: 0 auto 20px;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 10px 20px rgba(255, 92, 138, 0.1);
        }

        .login-card h2 { margin: 0; font-size: 26px; color: var(--pink-deep); font-weight: 800; }
        .login-card p { margin: 5px 0 25px; font-size: 14px; color: #888; }

        .input-group { position: relative; margin-bottom: 15px; }
        .input-group span { 
            position: absolute; left: 15px; top: 15px; 
            color: var(--pink-soft); font-size: 20px; 
        }
        .input-group input {
            width: 100%; padding: 15px 15px 15px 45px;
            background: rgba(255, 255, 255, 0.8);
            border: 2px solid transparent; border-radius: 20px;
            outline: none; font-family: inherit; font-size: 16px;
            transition: 0.3s;
        }
        .input-group input:focus { border-color: var(--pink-main); background: white; }

        /* --- APP STRUCTURE STYLING --- */
        .app-container {
            display: flex; flex-direction: column;
            height: 100vh; max-width: 500px; margin: 0 auto;
            position: relative; background: var(--pink-bg);
        }

        header {
            height: var(--header-h); display: flex; justify-content: space-between;
            align-items: center; padding: 0 24px; z-index: 100; background: var(--pink-bg);
        }
        header h1 { margin: 0; font-size: 22px; font-weight: 700; color: var(--pink-deep); }

        main { flex: 1; overflow-y: auto; padding: 10px 20px; -webkit-overflow-scrolling: touch; }

        nav {
            height: var(--nav-h); background: white;
            display: flex; justify-content: space-around; align-items: center;
            border-top-left-radius: 32px; border-top-right-radius: 32px;
            box-shadow: 0 -10px 30px rgba(255, 92, 138, 0.1);
            padding-bottom: env(safe-area-inset-bottom);
        }

        .nav-btn { 
            text-decoration: none; color: #d1d1d1;
            display: flex; flex-direction: column; align-items: center; gap: 4px;
        }
        .nav-btn.active { color: var(--pink-deep); }
        .nav-btn .material-icons-round { font-size: 30px; }

        /* Task Cards */
        .task-card { 
            background: white; padding: 20px; margin-bottom: 16px; border-radius: 24px; 
            display: flex; align-items: center; gap: 16px; 
            box-shadow: 0 8px 20px rgba(255, 133, 162, 0.05); 
        }
        .task-card.done { opacity: 0.6; }
        
        .checkbox-custom {
            width: 28px; height: 28px; border: 3px solid var(--pink-soft);
            border-radius: 10px; display: flex; align-items: center; justify-content: center;
            cursor: pointer; flex-shrink: 0;
        }
        .checkbox-custom.active { background: var(--pink-deep); border-color: var(--pink-deep); }
        .checkbox-custom .material-icons-round { color: white; font-size: 18px; display: none; }
        .checkbox-custom.active .material-icons-round { display: block; }

        /* Day Picker */
        .day-row { display: flex; justify-content: space-between; margin: 15px 0 25px; }
        .day-input { display: none; }
        .day-btn {
            width: 42px; height: 42px; border-radius: 14px;
            background: #fff; border: 2px solid var(--pink-soft);
            display: flex; align-items: center; justify-content: center;
            font-size: 13px; font-weight: 700; color: var(--pink-main);
        }
        .day-input:checked + .day-btn { background: var(--pink-deep); color: white; border-color: var(--pink-deep); }

        .btn-primary { 
            background: var(--pink-deep); color: white; border: none; padding: 18px; 
            border-radius: 22px; font-weight: 700; width: 100%; font-size: 16px;
            box-shadow: 0 10px 20px rgba(255, 92, 138, 0.2);
        }

        .hidden { display: none !important; }
    </style>
</head>
<body>

<div class="app-container">
    
    <div id="view-login">
        <span class="material-icons-round bg-heart" style="top:10%; left:10%; font-size:40px;">favorite</span>
        <span class="material-icons-round bg-heart" style="top:20%; right:15%; font-size:60px; animation-delay:1s;">favorite</span>
        <span class="material-icons-round bg-heart" style="bottom:15%; left:20%; font-size:50px; animation-delay:2s;">favorite</span>
        
        <div class="login-card">
            <div class="logo-area">
                <span class="material-icons-round" style="font-size: 45px; color: var(--pink-deep)">favorite</span>
            </div>
            <h2>Halo Angel!</h2>
            <p>Ayo atur harimu dengan cinta âœ¨</p>
            
            <form id="form-login">
                <div class="input-group">
                    <span class="material-icons-round">alternate_email</span>
                    <input type="email" id="login-email" placeholder="Email kamu..." required>
                </div>
                <div class="input-group">
                    <span class="material-icons-round">lock</span>
                    <input type="password" id="login-pass" placeholder="Password..." required>
                </div>
                <button type="submit" class="btn-primary" style="margin-top:10px;">Masuk Aplikasi</button>
            </form>
        </div>
    </div>

    <header id="app-header" class="hidden">
        <h1 id="page-title">Hari Ini</h1>
        <span class="material-icons-round" id="logout-btn" style="color:var(--pink-soft); cursor:pointer;">logout</span>
    </header>

    <main id="app-main" class="hidden">
        <div id="view-home" class="page hidden">
            <div id="today-list"></div>
        </div>

        <div id="view-missed" class="page hidden">
            <div id="missed-list"></div>
        </div>

        <div id="view-create" class="page hidden">
            <div style="background:white; padding:25px; border-radius:30px;">
                <h3 style="margin:0 0 20px; color: var(--pink-deep)">Rencana Baru</h3>
                <form id="form-add">
                    <p style="margin:0; font-size:14px; font-weight:600;">Judul Kegiatan</p>
                    <input type="text" id="title" placeholder="Contoh: Minum Vitamin" style="background:#f9f9f9; border:none; margin-bottom:15px;" required>
                    
                    <p style="margin:0; font-size:14px; font-weight:600;">Catatan</p>
                    <textarea id="desc" rows="2" placeholder="Catatan opsional..." style="background:#f9f9f9; border:none; margin-bottom:15px;"></textarea>
                    
                    <p style="margin:0; font-size:14px; font-weight:600;">Ulangi Hari:</p>
                    <div class="day-row">
                        <input type="checkbox" id="d1" class="day-input" value="1"><label for="d1" class="day-btn">Sen</label>
                        <input type="checkbox" id="d2" class="day-input" value="2"><label for="d2" class="day-btn">Sel</label>
                        <input type="checkbox" id="d3" class="day-input" value="3"><label for="d3" class="day-btn">Rab</label>
                        <input type="checkbox" id="d4" class="day-input" value="4"><label for="d4" class="day-btn">Kam</label>
                        <input type="checkbox" id="d5" class="day-input" value="5"><label for="d5" class="day-btn">Jum</label>
                        <input type="checkbox" id="d6" class="day-input" value="6"><label for="d6" class="day-btn">Sab</label>
                        <input type="checkbox" id="d0" class="day-input" value="0"><label for="d0" class="day-btn">Min</label>
                    </div>
                    <button type="submit" class="btn-primary">Simpan Jadwal</button>
                </form>
            </div>
        </div>
    </main>

    <nav id="app-nav" class="hidden">
        <a href="#home" class="nav-btn active" id="nav-home"><span class="material-icons-round">home</span></a>
        <a href="#create" class="nav-btn" id="nav-create">
            <div style="background:var(--pink-deep); width:50px; height:50px; border-radius:20px; display:flex; align-items:center; justify-content:center; margin-top:-30px; box-shadow:0 8px 20px rgba(255, 92, 138, 0.4);">
                <span class="material-icons-round" style="color:white; margin:0">add</span>
            </div>
        </a>
        <a href="#missed" class="nav-btn" id="nav-missed"><span class="material-icons-round">assignment_late</span></a>
    </nav>
</div>

<script>
    const API_BASE = "https://apis.geekpesantren.web.id/Api_Angel";

    function checkAuth() {
        if (!localStorage.getItem('angel_auth')) {
            $('#view-login').removeClass('hidden');
            $('#app-header, #app-main, #app-nav').addClass('hidden');
        } else {
            $('#view-login').addClass('hidden');
            $('#app-header, #app-main, #app-nav').removeClass('hidden');
            navigate();
        }
    }

    function navigate() {
        let hash = window.location.hash || '#home';
        $('.page').addClass('hidden');
        $('.nav-btn').removeClass('active');
        $(`#view-${hash.replace('#','')}`).removeClass('hidden');
        $(`#nav-${hash.replace('#','')}`).addClass('active');

        if(hash === '#home') { $('#page-title').text('Hari Ini'); loadToday(); }
        if(hash === '#missed') { $('#page-title').text('History Lupa'); loadMissed(); }
        if(hash === '#create') { $('#page-title').text('Buat Baru'); }
    }

    function loadToday() {
        $.getJSON(`${API_BASE}/list_today`, d => {
            let h = '';
            d.forEach(t => {
                h += `<div class="task-card ${t.log_id ? 'done' : ''}">
                    <div class="checkbox-custom ${t.log_id ? 'active' : ''}" onclick="toggleTask(${t.id})">
                        <span class="material-icons-round">done</span>
                    </div>
                    <div style="flex:1"><strong>${t.title}</strong><br><small style="color:#999">${t.description || ''}</small></div>
                </div>`;
            });
            $('#today-list').html(h || '<p style="text-align:center; opacity:0.3; margin-top:100px;">Belum ada jadwal hari ini</p>');
        });
    }

    function loadMissed() {
        $.getJSON(`${API_BASE}/list_missed`, d => {
            let h = '';
            if(d.length === 0) h = '<p style="text-align:center; opacity:0.3; margin-top:100px;">Semua tuntas!</p>';
            d.forEach(t => h += `<div class="task-card" style="border-left:6px solid #ffcc00"><strong>${t.title}</strong></div>`);
            $('#missed-list').html(h);
        });
    }

    function toggleTask(id) { $.post(`${API_BASE}/toggle_check`, { activity_id: id }, () => loadToday()); }

    $('#form-add').submit(function(e){
        e.preventDefault();
        let days = []; $('.day-input:checked').each(function(){ days.push($(this).val()); });
        $.post(`${API_BASE}/add_activity`, { title: $('#title').val(), description: $('#desc').val(), days: days.join(',') }, () => {
            window.location.hash = '#home'; $('#form-add')[0].reset(); $('.day-input').prop('checked', false);
        });
    });

    $('#form-login').submit(function(e){
        e.preventDefault();
        $.post(`${API_BASE}/login`, {email:$('#login-email').val(), password:$('#login-pass').val()}, () => {
            localStorage.setItem('angel_auth', 'true'); checkAuth();
        }).fail(() => alert('Sabar ya, passwordnya salah!'));
    });

    $('#logout-btn').click(() => { if(confirm('Logout?')){ localStorage.removeItem('angel_auth'); checkAuth(); }});

    window.onhashchange = navigate;
    $(document).ready(checkAuth);
</script>
</body>
</html>
